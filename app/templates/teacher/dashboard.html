{% extends "base.html" %}

{% block title %}Панель преподавателя{% endblock %}

{% block content %}
<!-- Header -->
<div class="row mb-4">
    <div class="col">
        <h2 class="mb-0">
            <i class="bi bi-speedometer2 text-primary me-2"></i>
            Панель управления
        </h2>
        <p class="text-muted mt-2">Добро пожаловать, {{ current_user.full_name }}!</p>
    </div>
</div>

<!-- Stats Cards -->
<div class="row g-4 mb-4">
    <div class="col-md-3">
        <div class="card border-0 shadow-sm" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
            <div class="card-body text-white p-4">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-white-50 mb-1">Всего групп</h6>
                        <h2 class="mb-0 fw-bold">{{ stats.total_groups }}</h2>
                    </div>
                    <i class="bi bi-people-fill" style="font-size: 3rem; opacity: 0.3;"></i>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card border-0 shadow-sm" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
            <div class="card-body text-white p-4">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-white-50 mb-1">Студентов</h6>
                        <h2 class="mb-0 fw-bold">{{ stats.total_students }}</h2>
                    </div>
                    <i class="bi bi-mortarboard-fill" style="font-size: 3rem; opacity: 0.3;"></i>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card border-0 shadow-sm" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
            <div class="card-body text-white p-4">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-white-50 mb-1">Посещаемость</h6>
                        <h2 class="mb-0 fw-bold">{{ stats.avg_attendance }}%</h2>
                    </div>
                    <i class="bi bi-graph-up-arrow" style="font-size: 3rem; opacity: 0.3;"></i>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card border-0 shadow-sm" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
            <div class="card-body text-white p-4">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-white-50 mb-1">% Сдачи</h6>
                        <h2 class="mb-0 fw-bold">{{ stats.pass_rate }}%</h2>
                    </div>
                    <i class="bi bi-trophy-fill" style="font-size: 3rem; opacity: 0.3;"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="row mb-4">
    <div class="col">
        <h4 class="mb-3">
            <i class="bi bi-lightning-fill text-warning me-2"></i>
            Быстрые действия
        </h4>
        <div class="row g-3">
            <div class="col-md-3">
                <a href="{{ url_for('teacher.attendance') }}" class="text-decoration-none">
                    <div class="card border-0 shadow-sm h-100 hover-card">
                        <div class="card-body text-center p-4">
                            <i class="bi bi-clipboard-check text-primary mb-3" style="font-size: 2.5rem;"></i>
                            <h5 class="card-title mb-0">Отметить посещаемость</h5>
                        </div>
                    </div>
                </a>
            </div>
            
            <div class="col-md-3">
                <a href="{{ url_for('teacher.standards') }}" class="text-decoration-none">
                    <div class="card border-0 shadow-sm h-100 hover-card">
                        <div class="card-body text-center p-4">
                            <i class="bi bi-stopwatch text-success mb-3" style="font-size: 2.5rem;"></i>
                            <h5 class="card-title mb-0">Внести результаты</h5>
                        </div>
                    </div>
                </a>
            </div>
            
            <div class="col-md-3">
                <a href="{{ url_for('teacher.groups') }}" class="text-decoration-none">
                    <div class="card border-0 shadow-sm h-100 hover-card">
                        <div class="card-body text-center p-4">
                            <i class="bi bi-people text-info mb-3" style="font-size: 2.5rem;"></i>
                            <h5 class="card-title mb-0">Мои группы</h5>
                        </div>
                    </div>
                </a>
            </div>
            
            <div class="col-md-3">
                <a href="{{ url_for('teacher.statements') }}" class="text-decoration-none">
                    <div class="card border-0 shadow-sm h-100 hover-card">
                        <div class="card-body text-center p-4">
                            <i class="bi bi-file-earmark-text text-warning mb-3" style="font-size: 2.5rem;"></i>
                            <h5 class="card-title mb-0">Ведомости</h5>
                        </div>
                    </div>
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Recent Assignments -->
{% if recent_assignments %}
<div class="row mb-4">
    <div class="col">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-0 py-3">
                <h5 class="mb-0">
                    <i class="bi bi-list-task text-primary me-2"></i>
                    Последние задания
                </h5>
            </div>
            <div class="card-body">
                <div class="list-group list-group-flush">
                    {% for assignment in recent_assignments %}
                    <div class="list-group-item border-0 px-0">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">{{ assignment.title }}</h6>
                                <p class="text-muted small mb-0">
                                    <i class="bi bi-person me-1"></i>{{ assignment.student.full_name }}
                                </p>
                            </div>
                            <div class="text-end">
                                <span class="badge bg-{{ assignment.status|status_badge }} mb-1">
                                    {{ assignment.status }}
                                </span>
                                <p class="text-muted small mb-0">
                                    <i class="bi bi-calendar me-1"></i>{{ assignment.deadline|format_date }}
                                </p>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <div class="text-center mt-3">
                    <a href="{{ url_for('teacher.assignments') }}" class="btn btn-outline-primary">
                        Все задания
                        <i class="bi bi-arrow-right ms-1"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Groups List -->
<div class="row">
    <div class="col">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h4 class="mb-0">
                <i class="bi bi-people-fill text-primary me-2"></i>
                Мои группы
            </h4>
            <a href="{{ url_for('teacher.groups') }}" class="btn btn-sm btn-outline-primary">
                Все группы
                <i class="bi bi-arrow-right ms-1"></i>
            </a>
        </div>
        
        {% if groups %}
        <div class="row g-3">
            {% for group in groups[:6] %}
            <div class="col-md-6 col-lg-4">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div>
                                <h5 class="card-title mb-1">{{ group.name }}</h5>
                                <p class="text-muted small mb-0">
                                    {{ group.specialty.name if group.specialty else 'Специальность не указана' }}
                                </p>
                            </div>
                            <span class="badge bg-primary">Курс {{ group.course }}</span>
                        </div>
                        
                        <div class="mb-3">
                            <div class="d-flex justify-content-between text-muted small mb-1">
                                <span><i class="bi bi-people me-1"></i>Студентов</span>
                                <strong class="text-dark">{{ group.students.count() }}</strong>
                            </div>
                            <div class="d-flex justify-content-between text-muted small">
                                <span><i class="bi bi-calendar3 me-1"></i>Семестр</span>
                                <strong class="text-dark">{{ group.semester }}</strong>
                            </div>
                        </div>
                        
                        <div class="d-grid gap-2">
                            <a href="{{ url_for('teacher.group_details', group_id=group.id) }}" 
                               class="btn btn-outline-primary btn-sm">
                                <i class="bi bi-eye me-1"></i>Подробнее
                            </a>
                            <a href="{{ url_for('teacher.rating', group_id=group.id) }}" 
                               class="btn btn-outline-success btn-sm">
                                <i class="bi bi-graph-up me-1"></i>Рейтинг
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="alert alert-info">
            <i class="bi bi-info-circle me-2"></i>
            У вас пока нет закрепленных групп.
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.hover-card {
    transition: all 0.3s ease;
    cursor: pointer;
}

.hover-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.15) !important;
}
</style>
{% endblock %}