{% extends "base.html" %}

{% block title %}Панель администратора{% endblock %}

{% block content %}
<!-- Header -->
<div class="row mb-4">
    <div class="col">
        <h2 class="mb-0">
            <i class="bi bi-speedometer2 text-primary me-2"></i>
            Панель администратора
        </h2>
        <p class="text-muted mt-2">Добро пожаловать, {{ current_user.full_name }}!</p>
    </div>
</div>

<!-- Stats Cards Row 1 -->
<div class="row g-4 mb-4">
    <div class="col-md-3">
        <a href="{{ url_for('admin.users') }}" class="text-decoration-none">
            <div class="card border-0 shadow-sm hover-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <div class="card-body text-white p-4">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-white-50 mb-1">Пользователей</h6>
                            <h2 class="mb-0 fw-bold">{{ stats.users_count }}</h2>
                        </div>
                        <i class="bi bi-people-fill" style="font-size: 3rem; opacity: 0.3;"></i>
                    </div>
                </div>
            </div>
        </a>
    </div>
    
    <div class="col-md-3">
        <div class="card border-0 shadow-sm" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
            <div class="card-body text-white p-4">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-white-50 mb-1">Преподавателей</h6>
                        <h2 class="mb-0 fw-bold">{{ stats.teachers_count }}</h2>
                    </div>
                    <i class="bi bi-person-badge-fill" style="font-size: 3rem; opacity: 0.3;"></i>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <a href="{{ url_for('admin.groups') }}" class="text-decoration-none">
            <div class="card border-0 shadow-sm hover-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                <div class="card-body text-white p-4">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-white-50 mb-1">Групп</h6>
                            <h2 class="mb-0 fw-bold">{{ stats.groups_count }}</h2>
                        </div>
                        <i class="bi bi-collection-fill" style="font-size: 3rem; opacity: 0.3;"></i>
                    </div>
                </div>
            </div>
        </a>
    </div>
    
    <div class="col-md-3">
        <div class="card border-0 shadow-sm" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
            <div class="card-body text-white p-4">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-white-50 mb-1">Студентов</h6>
                        <h2 class="mb-0 fw-bold">{{ stats.students_count }}</h2>
                    </div>
                    <i class="bi bi-mortarboard-fill" style="font-size: 3rem; opacity: 0.3;"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Stats Cards Row 2 -->
<div class="row g-4 mb-4">
    <div class="col-md-3">
        <div class="card border-0 shadow-sm">
            <div class="card-body text-center">
                <i class="bi bi-building text-primary mb-2" style="font-size: 2rem;"></i>
                <h4 class="mb-0">{{ stats.faculties_count }}</h4>
                <p class="text-muted small mb-0">Факультетов</p>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card border-0 shadow-sm">
            <div class="card-body text-center">
                <i class="bi bi-bookmark-fill text-success mb-2" style="font-size: 2rem;"></i>
                <h4 class="mb-0">{{ stats.specialties_count }}</h4>
                <p class="text-muted small mb-0">Специальностей</p>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card border-0 shadow-sm">
            <div class="card-body text-center">
                <i class="bi bi-list-check text-info mb-2" style="font-size: 2rem;"></i>
                <h4 class="mb-0">{{ stats.standards_count }}</h4>
                <p class="text-muted small mb-0">Нормативов</p>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card border-0 shadow-sm">
            <div class="card-body text-center">
                <i class="bi bi-check-circle-fill text-warning mb-2" style="font-size: 2rem;"></i>
                <h4 class="mb-0">{{ stats.active_standards_count }}</h4>
                <p class="text-muted small mb-0">Активных</p>
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="row mb-4">
    <div class="col">
        <h4 class="mb-3">
            <i class="bi bi-lightning-fill text-warning me-2"></i>
            Быстрые действия
        </h4>
        <div class="row g-3">
            <div class="col-md-3">
                <a href="{{ url_for('admin.create_user') }}" class="text-decoration-none">
                    <div class="card border-0 shadow-sm h-100 hover-card">
                        <div class="card-body text-center p-4">
                            <i class="bi bi-person-plus-fill text-primary mb-3" style="font-size: 2.5rem;"></i>
                            <h5 class="card-title mb-0">Создать пользователя</h5>
                        </div>
                    </div>
                </a>
            </div>
            
            <div class="col-md-3">
                <a href="{{ url_for('admin.groups') }}" class="text-decoration-none">
                    <div class="card border-0 shadow-sm h-100 hover-card">
                        <div class="card-body text-center p-4">
                            <i class="bi bi-people-fill text-success mb-3" style="font-size: 2.5rem;"></i>
                            <h5 class="card-title mb-0">Управление группами</h5>
                        </div>
                    </div>
                </a>
            </div>
            
            <div class="col-md-3">
                <a href="{{ url_for('admin.import_students') }}" class="text-decoration-none">
                    <div class="card border-0 shadow-sm h-100 hover-card">
                        <div class="card-body text-center p-4">
                            <i class="bi bi-file-earmark-arrow-up text-info mb-3" style="font-size: 2.5rem;"></i>
                            <h5 class="card-title mb-0">Импорт студентов</h5>
                        </div>
                    </div>
                </a>
            </div>
            
            <div class="col-md-3">
                <a href="{{ url_for('admin.create_standard') }}" class="text-decoration-none">
                    <div class="card border-0 shadow-sm h-100 hover-card">
                        <div class="card-body text-center p-4">
                            <i class="bi bi-clipboard-data text-warning mb-3" style="font-size: 2.5rem;"></i>
                            <h5 class="card-title mb-0">Создать норматив</h5>
                        </div>
                    </div>
                </a>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Recent Users -->
    <div class="col-md-6 mb-4">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-0 py-3">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="bi bi-person-circle text-primary me-2"></i>
                        Последние пользователи
                    </h5>
                    <a href="{{ url_for('admin.users') }}" class="btn btn-sm btn-outline-primary">
                        Все
                        <i class="bi bi-arrow-right ms-1"></i>
                    </a>
                </div>
            </div>
            <div class="card-body">
                {% if recent_users %}
                <div class="list-group list-group-flush">
                    {% for user in recent_users %}
                    <div class="list-group-item border-0 px-0 py-2">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">{{ user.full_name }}</h6>
                                <p class="text-muted small mb-0">{{ user.email }}</p>
                            </div>
                            <div class="text-end">
                                <span class="badge bg-{{ user.role|replace('admin', 'danger')|replace('teacher', 'primary')|replace('department_head', 'success') }}">
                                    {{ user.role|replace('admin', 'Админ')|replace('teacher', 'Преп.')|replace('department_head', 'Зав.') }}
                                </span>
                                {% if user.is_active %}
                                <span class="badge bg-success">Активен</span>
                                {% else %}
                                <span class="badge bg-secondary">Неактивен</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-muted mb-0">Нет пользователей</p>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Recent Groups -->
    <div class="col-md-6 mb-4">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-0 py-3">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="bi bi-collection text-primary me-2"></i>
                        Последние группы
                    </h5>
                    <a href="{{ url_for('admin.groups') }}" class="btn btn-sm btn-outline-primary">
                        Все
                        <i class="bi bi-arrow-right ms-1"></i>
                    </a>
                </div>
            </div>
            <div class="card-body">
                {% if recent_groups %}
                <div class="list-group list-group-flush">
                    {% for group in recent_groups %}
                    <div class="list-group-item border-0 px-0 py-2">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">{{ group.name }}</h6>
                                <p class="text-muted small mb-0">
                                    Курс {{ group.course }} | Студентов: {{ group.students.count() }}
                                </p>
                            </div>
                            <div>
                                <a href="{{ url_for('admin.edit_group', group_id=group.id) }}" 
                                   class="btn btn-sm btn-outline-primary">
                                    <i class="bi bi-pencil"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-muted mb-0">Нет групп</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Management Links -->
<div class="row">
    <div class="col">
        <h4 class="mb-3">
            <i class="bi bi-gear-fill text-primary me-2"></i>
            Управление системой
        </h4>
        <div class="row g-3">
            <div class="col-md-4">
                <div class="card border-0 shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title">
                            <i class="bi bi-people text-primary me-2"></i>
                            Пользователи
                        </h5>
                        <p class="card-text text-muted small">
                            Управление пользователями системы
                        </p>
                        <a href="{{ url_for('admin.users') }}" class="btn btn-sm btn-primary">
                            Перейти
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="card border-0 shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title">
                            <i class="bi bi-building text-success me-2"></i>
                            Факультеты
                        </h5>
                        <p class="card-text text-muted small">
                            Управление факультетами
                        </p>
                        <a href="{{ url_for('admin.faculties') }}" class="btn btn-sm btn-success">
                            Перейти
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="card border-0 shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title">
                            <i class="bi bi-collection text-info me-2"></i>
                            Группы
                        </h5>
                        <p class="card-text text-muted small">
                            Управление учебными группами
                        </p>
                        <a href="{{ url_for('admin.groups') }}" class="btn btn-sm btn-info">
                            Перейти
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="card border-0 shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title">
                            <i class="bi bi-bookmark text-warning me-2"></i>
                            Специальности
                        </h5>
                        <p class="card-text text-muted small">
                            Управление специальностями
                        </p>
                        <a href="{{ url_for('admin.specialties') }}" class="btn btn-sm btn-warning">
                            Перейти
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="card border-0 shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title">
                            <i class="bi bi-clipboard-data text-danger me-2"></i>
                            Нормативы
                        </h5>
                        <p class="card-text text-muted small">
                            Управление нормативами и шкалами
                        </p>
                        <a href="{{ url_for('admin.standards') }}" class="btn btn-sm btn-danger">
                            Перейти
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="card border-0 shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title">
                            <i class="bi bi-grid text-secondary me-2"></i>
                            Модули
                        </h5>
                        <p class="card-text text-muted small">
                            Управление модулями и темами
                        </p>
                        <a href="{{ url_for('admin.modules') }}" class="btn btn-sm btn-secondary">
                            Перейти
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.hover-card {
    transition: all 0.3s ease;
    cursor: pointer;
}

.hover-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.15) !important;
}
</style>
{% endblock %}