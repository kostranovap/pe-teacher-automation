{% extends "base.html" %}

{% block title %}Результаты нормативов - {{ student.full_name }}{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ url_for('student.search') }}">Поиск</a></li>
            <li class="breadcrumb-item"><a href="{{ url_for('student.profile', student_id=student.id) }}">{{ student.full_name }}</a></li>
            <li class="breadcrumb-item active">Результаты нормативов</li>
        </ol>
    </nav>

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="bi bi-trophy me-2"></i>Результаты нормативов</h2>
        <a href="{{ url_for('student.profile', student_id=student.id) }}" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left me-1"></i>Назад к профилю
        </a>
    </div>

    <!-- Статистика -->
    <div class="row mb-4">
        <div class="col-md-4 mb-3">
            <div class="card border-primary">
                <div class="card-body text-center">
                    <i class="bi bi-clipboard-data text-primary fs-1"></i>
                    <h3 class="mt-2">{{ stats.total }}</h3>
                    <p class="text-muted mb-0">Всего результатов</p>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card border-success">
                <div class="card-body text-center">
                    <i class="bi bi-star text-success fs-1"></i>
                    <h3 class="mt-2">{{ stats.avg_points }}</h3>
                    <p class="text-muted mb-0">Средний балл</p>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card border-warning">
                <div class="card-body text-center">
                    <i class="bi bi-award text-warning fs-1"></i>
                    <h3 class="mt-2">{{ stats.best_results|length }}</h3>
                    <p class="text-muted mb-0">Лучших результатов</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Лучшие результаты -->
    {% if stats.best_results %}
    <div class="card shadow-sm mb-4 border-warning">
        <div class="card-header bg-warning text-dark">
            <h5 class="mb-0"><i class="bi bi-trophy-fill me-2"></i>Лучшие результаты</h5>
        </div>
        <div class="card-body">
            <div class="row">
                {% for result in stats.best_results %}
                <div class="col-md-6 mb-2">
                    <div class="d-flex justify-content-between align-items-center p-2 border rounded">
                        <div>
                            <strong>{{ result.standard.name }}</strong>
                            <br>
                            <small class="text-muted">{{ result.result_value }} {{ result.standard.unit }}</small>
                        </div>
                        <span class="badge bg-success fs-6">{{ result.points }} баллов</span>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Результаты по модулям и темам -->
    {% if results_by_module %}
        {% for module_name, themes in results_by_module.items() %}
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">{{ module_name }}</h5>
            </div>
            <div class="card-body">
                {% for theme_name, results in themes.items() %}
                <h6 class="text-secondary mb-3">{{ theme_name }}</h6>
                <div class="table-responsive mb-4">
                    <table class="table table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>Норматив</th>
                                <th>Результат</th>
                                <th>Баллы</th>
                                <th>Дата</th>
                                <th>Попытка</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for result in results %}
                            <tr>
                                <td>{{ result.standard.name }}</td>
                                <td><strong>{{ result.result_value }}</strong> {{ result.standard.unit }}</td>
                                <td>
                                    <span class="badge bg-{{ 'success' if result.points == 5 else ('primary' if result.points == 4 else ('info' if result.points == 3 else 'warning')) }}">
                                        {{ result.points }} из 5
                                    </span>
                                </td>
                                <td>{{ result.date.strftime('%d.%m.%Y') }}</td>
                                <td class="text-muted small">№{{ result.attempt_number }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    {% else %}
    <div class="card shadow-sm">
        <div class="card-body text-center py-5 text-muted">
            <i class="bi bi-trophy fs-1 mb-3"></i>
            <p>Нет результатов нормативов</p>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}